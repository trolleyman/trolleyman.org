(function(t,e){function i(t,e){return Math.atan(-e/t)}function s(){this.posX=0;this.posY=at();this.velX=150;this.velY=20;this.ang=i(this.velX,this.velY);this.prevAng=this.ang;this.flapButtonDownPrev=false;this.t=0;this.dead=false}s.prototype.getBB=function(t,e){return new T(this.posX,this.posY,t,e,this.ang)};function n(t,e,i,s){this.x=t;this.y=e;this.img=i;this.f=s}Object.defineProperty(n.prototype,"x",{get:function(){if(typeof this._x==="function")return this._x();else return this._x},set:function(t){this._x=t}});Object.defineProperty(n.prototype,"y",{get:function(){if(typeof this._y==="function")return this._y();else return this._y},set:function(t){this._y=t}});n.prototype.draw=function(t){h(t,this.img,this.x,this.y)};n.prototype.handleClick=function(t,e){if(t>=this.x&&t<this.x+this.img.width&&e>=this.y&&e<this.y+this.img.height){this.f();return true}return false};function a(t,e,i,s,n,a){this._x=t;this._y=e;this.img=i;this.imgDisabled=s;this.f=n;this.isDisabled=a}Object.defineProperty(a.prototype,"x",{get:function(){if(typeof this._x==="function")return this._x();else return this._x},set:function(t){this._x=t}});Object.defineProperty(a.prototype,"y",{get:function(){if(typeof this._y==="function")return this._y();else return this._y},set:function(t){this._y=t}});a.prototype.draw=function(t){if(this.isDisabled())h(t,this.imgDisabled,this.x,this.y);else h(t,this.img,this.x,this.y)};a.prototype.handleClick=function(t,e){if(this.isDisabled()){return false}if(t>=this.x&&t<this.x+this.img.width&&e>=this.y&&e<this.y+this.img.height){this.f();return true}return false};function r(t,e,i){var s=new Date;s.setTime(s.getTime()+i*24*60*60*1e3);var n="expires="+s.toUTCString();document.cookie=t+"="+e+";"+n+";path=/"}function o(t){var e=t+"=";var i=document.cookie.split(";");for(var s=0;s<i.length;s++){var n=i[s];while(n.charAt(0)==" "){n=n.substring(1)}if(n.indexOf(e)==0){return n.substring(e.length,n.length)}}return""}function h(t,e,i,s){var n=e.width,a=e.height;t.drawImage(e,0,0,n,a,Math.round(i),Math.round(s),n,a)}function d(t,e,i,s,n,a){if(typeof i==="undefined")i=0;if(typeof s==="undefined")s=0;if(typeof n==="undefined")n=Infinity;if(typeof a==="undefined")a=Infinity;var r=t.canvas.width,o=t.canvas.height,d=e.width,u=e.height;if(d==0||u==0)return;var f=0;for(var l=s;l<o&&f<a;l+=u){var p=0;for(var c=i;c<r&&p<n;c+=d){h(t,e,c,l,d,u);p+=1}f+=1}}function u(t,e,i,s,n,a,r,o){function h(t,e,i,s,n,a,r){if(typeof a==="undefined")a=0;if(typeof r==="undefined")r=0;a*=n;r*=n;t.fillText(e,i+a,s+r)}if(typeof n==="undefined")n="white";if(typeof a==="undefined")a=5;if(typeof r!=="undefined"){if(r<=0){return}var d=t.measureText("...").width;var u=function(e){return t.measureText(e).width+2*a};var f=function(t){return u(t)+d};var l=u(e);var p=false;while(l>r&&e.length!==0){if(o)e=e.substring(1,e.length);else e=e.substring(0,e.length-1);p=true;l=f(e)}if(p){if(o)e="..."+e;else e=e+"..."}}t.fillStyle="black";h(t,e,i,s,a,1,1);h(t,e,i,s,a,1,-1);h(t,e,i,s,a,-1,1);h(t,e,i,s,a,-1,-1);t.fillStyle=n;h(t,e,i,s,a)}(function(t,e){"use strict";var i="AxmTYklsjo190QW",s="sans-serif",n="serif",a={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},r=["display:block","position:absolute","top:-999px","left:-999px","font-size:48px","width:auto","height:auto","line-height:normal","margin:0","padding:0","font-variant:normal","white-space:nowrap"],o='<div style="%s">'+i+"</div>";var h=function(){this.fontFamily="";this.appended=false;this.serif=undefined;this.sansSerif=undefined;this.parent=undefined;this.options={}};h.prototype.getMeasurements=function(){return{sansSerif:{width:this.sansSerif.offsetWidth,height:this.sansSerif.offsetHeight},serif:{width:this.serif.offsetWidth,height:this.serif.offsetHeight}}};h.prototype.load=function(){var i=new Date,a=this,h=a.serif,d=a.sansSerif,u=a.parent,f=a.appended,l,p=a.options,c=p.reference;function g(t){return r.concat(["font-weight:"+p.weight,"font-style:"+p.style]).concat("font-family:"+t).join(";")}var y=o.replace(/\%s/,g(s)),v=o.replace(/\%s/,g(n));if(!u){u=a.parent=e.createElement("div")}u.innerHTML=y+v;d=a.sansSerif=u.firstChild;h=a.serif=d.nextSibling;if(p.glyphs){d.innerHTML+=p.glyphs;h.innerHTML+=p.glyphs}function m(t,e,i){return Math.abs(t.width-e.offsetWidth)>i||Math.abs(t.height-e.offsetHeight)>i}function b(){return(new Date).getTime()-i.getTime()>p.timeout}(function i(){if(!c){c=e.body}if(!f&&c){c.appendChild(u);f=a.appended=true;l=a.getMeasurements();d.style.fontFamily=a.fontFamily+", "+s;h.style.fontFamily=a.fontFamily+", "+n}if(f&&l&&(m(l.sansSerif,d,p.tolerance)||m(l.serif,h,p.tolerance))){p.success()}else if(b()){p.error()}else{if(!f&&"requestAnimationFrame"in window){t.requestAnimationFrame(i)}else{t.setTimeout(i,p.delay)}}})()};h.prototype.cleanFamilyName=function(t){return t.replace(/[\'\"]/g,"").toLowerCase()};h.prototype.cleanWeight=function(t){var e={normal:"400",bold:"700"};return""+(e[t]||t)};h.prototype.checkFontFaces=function(i){var s=this;e.fonts.forEach(function(e){if(s.cleanFamilyName(e.family)===s.cleanFamilyName(s.fontFamily)&&s.cleanWeight(e.weight)===s.cleanWeight(s.options.weight)&&e.style===s.options.style){e.load().then(function(){s.options.success();t.clearTimeout(i)})}})};h.prototype.init=function(i,s){var n;for(var r in a){if(!s.hasOwnProperty(r)){s[r]=a[r]}}this.options=s;this.fontFamily=i;if(!s.glyphs&&"fonts"in e){if(s.timeout){n=t.setTimeout(function(){s.error()},s.timeout)}this.checkFontFaces(n)}else{this.load()}};var d=function(t,e){var i=new h;i.init(t,e);return i};t.FontFaceOnload=d})(this,this.document);"use strict";const f=250;const l=400;const p=0;const c=1;const g=2;const y=3;const v=4;const m=5;const b=6;const w=32;window.onload=function(){var t=new S;window.requestAnimationFrame(t.mainLoop.bind(t))};function x(t){if(t===p)return"STATE_LOADING";else if(t===c)return"STATE_START";else if(t===g)return"STATE_PLAYING";else if(t===y)return"STATE_PAUSED";else if(t===v)return"STATE_DEATH";else if(t===m)return"STATE_LEADERBOARD";else if(t===b)return"STATE_LEADERBOARD_ERROR";else return"Invalid state: "+t}function L(t){return{identifier:touch.identifier,pageX:touch.pageX,pageY:touch.pageY}}function S(){this.canvas=document.getElementById("canvas");this.usernameEntry=document.getElementById("username-entry");this.canvas.onmousedown=this.onmousedown.bind(this);this.canvas.onmouseup=this.onmouseup.bind(this);this.canvas.addEventListener("touchstart",this.ontouchstart.bind(this));this.canvas.addEventListener("touchend",this.ontouchend.bind(this));this.canvas.addEventListener("touchcancel",this.ontouchcancel.bind(this));this.canvas.addEventListener("touchmove",this.ontouchmove.bind(this));this.touches=[];this.keyCodes=[];this.keyWhichs=[];this.keyUps=[];this.keyDowns=[];window.onkeyup=function(t){this.keyCodes[t.code]=false;this.keyWhichs[t.which]=false;this.keyUps[this.keyUps.length]=t}.bind(this);window.onkeydown=function(t){this.keyCodes[t.code]=true;this.keyWhichs[t.which]=true;this.keyDowns[this.keyDowns.length]=t}.bind(this);this.flappyFontLoaded=false;var t=function(){var t={success:function(){console.log("FlappyFont loaded.");this.flappyFontLoaded=true;this.notifyLoadedFont()}.bind(this),error:function(){console.log("FlappyFont could not be downloaded.");this.flappyFontLoaded=true;this.notifyLoadedFont()}.bind(this)};FontFaceOnload("FlappyFont",t)}.bind(this);this.imgs={};this.imgs.flappy=[];this.imgs.deadFlappy=[];this.flappysLoaded=false;var e=function(){if(typeof this.flappysLoadedNum==="undefined")this.flappysLoadedNum=0;this.flappysLoadedNum+=1;if(this.flappysLoadedNum===4){this.flappysLoaded=true;t()}}.bind(this);for(var i=0;i<4;i++){this.imgs.flappy[i]=this.loadImage("flappy"+i+".png",e)}for(var i=0;i<4;i++){this.imgs.deadFlappy[i]=this.loadImage("deadFlappy"+i+".png")}this.imgs.bg=this.loadImage("background.png");this.imgs.bgBlank=this.loadImage("backgroundBlank.png");this.imgs.pipe=this.loadImage("pipe.png");this.imgs.pipeHead=this.loadImage("pipeHead.png");this.imgs.ground=this.loadImage("ground.png");this.imgs.tapInfo=this.loadImage("tapInfo.png");this.imgs.new=this.loadImage("new.png");this.imgs.buttonPlay=this.loadImage("buttonPlay.png");this.imgs.buttonPause=this.loadImage("buttonPause.png");this.imgs.buttonRestart=this.loadImage("buttonRestart.png");this.imgs.buttonLeaderboard=this.loadImage("buttonLeaderboard.png");this.imgs.buttonSubmit=this.loadImage("buttonSubmit.png");this.imgs.buttonSubmitDisabled=this.loadImage("buttonSubmitDisabled.png");this.imgs.buttonRetry=this.loadImage("buttonRetry.png");var s=Object.getOwnPropertyDescriptor(S.prototype,"state").set;var r=20;var o=50,h=50;var d=ht;this.buttonPlay=new n(d,d,this.imgs.buttonPlay,s.bind(this,g));this.buttonPause=new n(d,d,this.imgs.buttonPause,s.bind(this,y));var u=yt;var f=function(){var t=r+this.imgs.buttonRestart.width+this.imgs.buttonLeaderboard.width;var e=this.canvas.width/2-t/2;return e}.bind(this);this.buttonRestartDeath=new n(f,u,this.imgs.buttonRestart,s.bind(this,c));this.buttonLeaderboard=new n(function(){return f()+r+this.imgs.buttonRestart.width}.bind(this),u,this.imgs.buttonLeaderboard,s.bind(this,m));u=Ft;this.buttonRestartLeaderboard=new n(function(){return this.canvas.width/2-this.imgs.buttonRestart.width-r/2}.bind(this),u,this.imgs.buttonRestart,s.bind(this,c));var l=function(){var t=this.usernameEntry.value;var e=_(t);if(!e.legal){console.error("'"+t+"' is invalid: "+e.reason);alert(e.reason);return}console.log("Submitting best score for '"+t+"': "+this.bestScore);this.submitting=true;this.submittingStartTime=Date.now().valueOf()/1e3;this.errorSubmitting=false;this.submitted=false;this.endTextEntryMode();this.leaderboard[this.leaderboardPos].name=t;W(t,this.bestScore,function(){console.log("Submitted score.");this.submitting=false;this.submitted=true}.bind(this),function(t){this.submitting=false;this.submitted=false;console.log("error submitting score: "+t);this.errorSubmitting=true}.bind(this))}.bind(this);var v=function(){if(!this.newBestScore||this.leaderboardLoading||!_(this.usernameEntry.value).legal||this.submitting||this.submitted)return true;return false}.bind(this);this.buttonSubmit=new a(function(){return this.canvas.width/2+r/2}.bind(this),u,this.imgs.buttonSubmit,this.imgs.buttonSubmitDisabled,l,v);u=400;this.buttonRestartLeaderboardError=new n(function(){return this.canvas.width/2-this.imgs.buttonRestart.width-r/2}.bind(this),u,this.imgs.buttonRestart,s.bind(this,c));this.buttonRetry=new n(function(){return this.canvas.width/2+r/2}.bind(this),u,this.imgs.buttonRetry,s.bind(this,m));this.pipes=[];for(var i=0;i<10;i++){this.pipes[i]=new A(-200)}var b,w;if(typeof document.hidden!=="undefined"){b="hidden";w="visibilitychange"}else if(typeof document.msHidden!=="undefined"){b="msHidden";w="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){b="webkitHidden";w="webkitvisibilitychange"}var x=function(){if(document[b]){console.log("Page hidden: paused.");this.pause();if(this.state===g)this.state=y}else{if(this.state!==y){console.log("Page unhidden: resumed.");this.unpause()}}}.bind(this);if(typeof document.addEventListener==="undefined"||typeof document[b]==="undefined"){console.log("Error: Page Visibility API not supported.")}else{document.addEventListener(w,x,false)}this.stats=document.getElementById("stats");this.debugAllowed=false;this.debugView=false;this.cameraUpdate=true;this.flappyDt=.08;this.paused=false;this.cameraX=0;this.beginTextEntryMode();this.endTextEntryMode();this.state=p}S.prototype.loadImage=function(t,e){if(typeof e==="undefined")e=function(){};if(typeof this.imagesLoadedMax==="undefined")this.imagesLoadedMax=0;this.imagesLoadedMax+=1;var i=new Image;i.onload=function(){e();this.notfiyLoadedImage()}.bind(this);i.src=document.head.querySelector("meta[name=static]").getAttribute("value")+"img/"+t;return i};S.prototype.notfiyLoadedImage=function(){if(typeof this.imagesLoadedNum==="undefined")this.imagesLoadedNum=0;this.imagesLoadedNum+=1;if(this.imagesLoaded){console.log(this.imagesLoadedNum+" images loaded.");this.notifyLoadedResource()}};S.prototype.notifyLoadedFont=function(){this.notifyLoadedResource()};S.prototype.notifyLoadedResource=function(){if(this.imagesLoaded&&this.flappyFontLoaded){this.state=c}};Object.defineProperty(S.prototype,"imagesLoaded",{get:function(){return this.imagesLoadedNum===this.imagesLoadedMax}});Object.defineProperty(S.prototype,"flappyCurrent",{get:function(){if(this.deadFlappyImage)return this.imgs.deadFlappy[Math.floor(this.flappyi)];else return this.imgs.flappy[Math.floor(this.flappyi)]}});Object.defineProperty(S.prototype,"stateChangeDt",{get:function(){return(Date.now().valueOf()-this.stateChangeTime)/1e3}});Object.defineProperty(S.prototype,"state",{get:function(){return this.state_},set:function(t){const e=-800;console.log("STATE CHANGE: "+x(this.state_)+" => "+x(t));this.stateChangeTime=Date.now().valueOf();var i=this.state_;this.state_=t;this.endTextEntryMode();if(t===p){this.buttons=[];this.bird=new s;this.paused=true;this.flappyi=0;this.regenPipes=false;this.cameraUpdate=false;this.flappyVisible=false;this.groundVisible=false}else if(t===c){this.buttons=[];this.deadFlappyImage=false;this.gravity=0;this.bestScore=B();this.prevTime=NaN;this.score=0;this.paused=false;this.bird=new s;this.flappyi=0;this.oscillate=true;this.regenPipes=false;this.cameraUpdate=true;this.flappyVisible=true;this.groundVisible=true;for(var n=0;n<this.pipes.length;n++){this.pipes[n]=new A(-200)}}else if(t===g){this.buttons=[this.buttonPause];this.deadFlappyImage=false;this.gravity=e;this.oscillate=false;this.regenPipes=true;this.paused=false;this.prevTime=NaN;this.cameraUpdate=true;this.flappyVisible=true;this.groundVisible=true;if(i!==y){for(var n=0;n<10;n++){this.pipes[n].passed=true;this.pipes[n].x=-200}this.pipeMax=this.bird.posX+Math.max(800,this.canvas.width)}}else if(t===y){this.buttons=[this.buttonPlay];this.deadFlappyImage=false;this.gravity=e;this.oscillate=false;this.regenPipes=true;this.paused=true;this.cameraUpdate=true;this.flappyVisible=true;this.groundVisible=true}else if(t===v){this.buttons=[this.buttonRestartDeath,this.buttonLeaderboard];this.deadFlappyImage=true;this.gravity=e;this.oscillate=false;this.regenPipes=true;this.newBestScore=false;this.cameraUpdate=true;this.flappyVisible=true;this.groundVisible=true;if(this.score>this.bestScore){this.bestScore=this.score;this.newBestScore=true;this.submitted=false;this.errorSubmitting=false;O(this.bestScore)}this.bird.velY=300;this.bird.velX=0}else if(t===m){this.buttons=[this.buttonRestartLeaderboard,this.buttonSubmit];this.deadFlappyImage=true;this.gravity=e;this.oscillate=false;this.regenPipes=true;this.leaderboard=[];this.leaderboardLoading=true;this.cameraUpdate=true;this.flappyVisible=true;this.groundVisible=true;var a=function(t){this.leaderboard=t;this.leaderboardLoading=false;console.log("Leaderboard loaded ("+t.length+" entries)");console.log("Leaderboard: "+JSON.stringify(t));if(this.newBestScore){var e=-1;for(var i=0;i<U;i++){var s=t[i];if(typeof s==="undefined"||this.bestScore>s.score){e=i;break}}if(e!==-1){this.leaderboardPos=e;t.splice(e,0,{user:true,name:"",score:this.bestScore});this.beginTextEntryMode(Y,N)}}}.bind(this);var r=function(t){console.log("Error loading leaderboard: "+t);this.state=b}.bind(this);V(a,r)}else if(this.state===b){this.buttons=[this.buttonRestartLeaderboardError,this.buttonRetry];this.deadFlappyImage=true;this.gravity=e;this.oscillate=false;this.regenPipes=true;this.cameraUpdate=true;this.flappyVisible=true;this.groundVisible=true}else{console.log("Error: Invalid state: "+t);this.state=c}}});S.prototype.mainLoop=function(){window.requestAnimationFrame(this.mainLoop.bind(this));this.processKeys();this.update();this.draw();this.keyUps=[];this.keyDowns=[]};S.prototype.beginTextEntryMode=function(t,e){this.usernameEntry.value="";if(typeof t==="undefined")t=32;if(typeof e==="undefined")e=function(t){return true};this.usernameEntry.onkeypress=function(t){var i=String.fromCharCode(t.charCode);for(var s=0;s<i.length;s++)if(!e(i[s])){t.preventDefault();break}}.bind(this);this.usernameEntry.maxLength=t;this.usernameEntry.style.visibility="visible";this.usernameEntry.focus()};S.prototype.endTextEntryMode=function(){this.usernameEntry.style.visibility="hidden"};S.prototype.processKeys=function(){for(var t=0;t<this.keyDowns.length;t++){var e=this.keyDowns[t];var i=e.which;var s=e.key;var n=e.code;if(i===w){this.flap()}if(n==="Escape"&&(this.debugAllowed||this.state===g||this.state===y)){this.togglePause()}if(n==="Digit1"&&this.debugAllowed){this.debugView=!this.debugView}if(n==="Digit2"&&this.debugAllowed){this.cameraUpdate=!this.cameraUpdate}console.log("Key pressed: "+i+" '"+s+"' ("+n+")")}};S.prototype.pause=function(){if(this.state===g){this.state=y}else{this.paused=true}};S.prototype.unpause=function(){if(this.state===y){this.state=g}else{this.paused=false;this.prevTime=NaN}};S.prototype.togglePause=function(){if(this.state===g){this.state=y}else if(this.state===y){this.state=g}else{this.paused=!this.paused;if(!this.paused)this.prevTime=NaN}};S.prototype.press=function(t,e){var i=this.buttons;for(var s=0;s<i.length;s++){i[s].handleClick(t,e)}};S.prototype.onmousedown=function(t){t.preventDefault();console.log("mouse pressed @ "+t.offsetX+", "+t.offsetY);this.flap();this.press(t.offsetX,t.offsetY)};S.prototype.onmouseup=function(t){};S.prototype.ontouchstart=function(t){t.preventDefault();this.flap();var e=t.changedTouches;for(var i=0;i<e.length;i++){var s=e[i];console.log("touch @ "+s.clientX+", "+s.clientY);this.press(s.clientX,s.clientY)}};S.prototype.ontouchend=function(t){};S.prototype.ontouchcancel=function(t){};S.prototype.ontouchmove=function(t){};S.prototype.update=function(){if(this.paused)return;var t=Date.now().valueOf();if(isNaN(this.prevTime)){this.prevTime=t}var e=(t-this.prevTime)/1e3;this.prevTime=t;if(this.state===c||this.state===g)this.flappyi=(this.flappyi+e/this.flappyDt)%this.imgs.flappy.length;this.updateFlappy(e);if(this.regenPipes){for(var i=0;i<this.pipes.length;i++){var s=this.pipes[i];if(!s.passed&&s.x+this.imgs.pipeHead.width/2<this.bird.posX){this.score+=1;s.passed=true}if(s.x+this.imgs.pipeHead.width<this.cameraX){s.reuse(this.pipeMax);this.pipeMax+=f}}}};S.prototype.flap=function(){if(this.state===c||this.state===g)this.bird.velY=l;if(this.state===c)this.state=g};S.prototype.updateFlappy=function(t){var e=this.bird;e.velY+=t*this.gravity;if(this.oscillate){e.t+=t;e.t%=Math.PI*2;e.velY=Math.cos(e.t*4)*70}var s=this.imgs.ground.height+this.flappyCurrent.height/2;if(e.posY<=s&&e.velY<0){e.velY=0}if(e.posY<=s){e.posY=s;if(this.state===g)this.state=v}var n=this.canvas.height;var a=this.flappyCurrent.height/2;if(e.posY+a>n){e.posY=n-a;e.velY=0}e.posX+=t*e.velX;e.posY+=t*e.velY;e.ang=i(e.velX,e.velY);e.ang=(e.ang-e.prevAng)*Math.min(1,15*t)+e.prevAng;e.prevAng=e.ang;if(this.state===c||this.state===g){var r=e.getBB(this.flappyCurrent.width,this.flappyCurrent.height);for(var o=0;o<this.pipes.length;o++){var h=this.pipes[o];var d=r.x+r.w/2,u=r.x-r.w/2;var f=h.x+this.imgs.pipeHead.width,l=h.x;if(u>f||d<l)continue;var p=h.bbUpper(this.imgs.pipeHead.width);var y=h.bbLower(this.imgs.pipeHead.width);var m=false;if(r.intersects(p)){console.log("bird intersects with pipe "+o+" (UPPER)");m=true}else if(r.intersects(y)){console.log("bird intersects with pipe "+o+" (LOWER)");m=true}if(m){this.state=v}}}};S.prototype.draw=function(){if(window.innerWidth<j)this.canvas.width=j;else if(window.innerWidth>q)this.canvas.width=q;else this.canvas.width=window.innerWidth;if(window.innerHeight<G)this.canvas.height=G;else if(window.innerHeight>z)this.canvas.height=z;else this.canvas.height=window.innerHeight;var t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height);t.imageSmoothingEnabled=false;if(this.cameraUpdate)this.cameraX=this.bird.posX-60-this.canvas.width/20;if(this.debugView){this.drawStats()}else{this.stats.style.visibility="hidden"}if(this.groundVisible){d(t,this.imgs.bgBlank);var e=-this.imgs.bg.width-this.cameraX/2%this.imgs.bg.width;d(t,this.imgs.bg,e,t.canvas.height-this.imgs.bg.height,undefined,1);for(var i=0;i<this.pipes.length;i++){this.drawPipe(t,this.pipes[i])}var s=-this.imgs.ground.width-this.cameraX%this.imgs.ground.width;d(t,this.imgs.ground,s,t.canvas.height-this.imgs.ground.height,undefined,1)}if(this.flappyVisible)this.drawFlappy(t);this.drawUI(t)};S.prototype.drawUI=function(t){if(this.state===p)this.drawLoadingUI(t);if(this.state===c)this.drawStartUI(t);if(this.state===g||this.state===y)this.drawPlayingUI(t);if(this.state===v)this.drawDeathUI(t);if(this.state===m)this.drawLeaderboardUI(t);if(this.state===b)this.drawLeaderboardErrorUI(t);var e=this.buttons;for(var i=0;i<e.length;i++){var s=e[i];s.draw(t)}};S.prototype.drawLoadingUI=function(t){var e=t.canvas.width/2;var i=t.canvas.height/2;if(this.flappysLoaded)this.drawLoadingAnimation(t,this.stateChangeDt,e,i,false)};S.prototype.drawPlayingUI=function(t){t.textAlign="left";t.textBaseline="top";t.font="30px FlappyFont";u(t,this.score,dt(),ut(),"white",2)};S.prototype.drawStartUI=function(t){h(t,this.imgs.tapInfo,rt()+this.bird.posX-this.cameraX,t.canvas.height-at()-this.imgs.tapInfo.height/2);t.textAlign="center";t.textBaseline="top";t.font="60px FlappyFont";var e=Math.floor(t.canvas.width/2);var i="gold";u(t,"Flappy",e,ot(),i);u(t,"Clone",e,ot()+60+20,i)};S.prototype.drawDeathUI=function(t){t.textAlign="center";t.textBaseline="top";t.font="60px FlappyFont";var e="gold";if(!ft()){u(t,"Game Over",Math.floor(t.canvas.width/2),lt(),e)}else{u(t,"Game",Math.floor(t.canvas.width/2),lt(),e);u(t,"Over",Math.floor(t.canvas.width/2),pt(),e)}t.font="30px FlappyFont";var i=70;var s=Math.floor(t.canvas.width/2-i);var n=Math.floor(t.canvas.width/2+i);var a=ct();var r=gt();var o=3;u(t,"Score",s,a,"white",o);u(t,"Best",n,a,"white",o);u(t,this.score,s,r,"white",o);u(t,this.bestScore,n,r,"white",o);if(this.newBestScore)h(t,this.imgs.new,n+27,a-10)};S.prototype.drawLeaderboardUI=function(t){this.drawLeaderboardHeader(t);if(this.leaderboardLoading){var e=t.canvas.width/2;var i=t.canvas.height/2;this.drawLoadingAnimation(t,this.stateChangeDt,e,i,true)}else{this.drawLeaderboard(t)}};S.prototype.drawLeaderboardErrorUI=function(t){var e=this.imgs.deadFlappy[2];var i=-e.width/2;var s=-e.height/2;var n=t.canvas.width/2;var a=345;t.translate(n,a);t.rotate(Math.PI);h(t,e,i,s);t.rotate(-Math.PI);t.translate(-n,-a);t.textAlign="center";t.textBaseline="top";t.font="60px FlappyFont";u(t,"Error",n,110,"red");var r=50,o=210;t.font="30px FlappyFont";u(t,"The leaderboard could",n,o,"white",3);u(t,"not be loaded.",n,o+r,"white",3)};S.prototype.drawLeaderboardHeader=function(t){t.textAlign="center";t.textBaseline="top";t.font=wt()+"px FlappyFont";var e="gold";u(t,"Leaderboard",Math.floor(t.canvas.width/2),Tt(),e,Lt())};S.prototype.drawLeaderboard=function(t){t.textBaseline="top";t.font=xt()+"px FlappyFont";var e=Math.min(t.canvas.width,J);var i=t.canvas.width/2-e/2;var s=t.canvas.width-i;var n=St();var a=t.measureText("SCORE").width;var r=i+It();var o=8;var h=s-Mt();var d=Et();var f="gold";t.textAlign="right";u(t,"NAME",h-o,d,f,n);u(t,"#",r,d,f,n);t.textAlign="left";u(t,"SCORE",h+o,d,f,n);var l=h+o+a/2;for(var p=0;p<U;p++){var c=this.leaderboard[p];if(typeof c==="undefined")break;var g="white";var y=y=Math.floor(5*this.stateChangeDt%3)===0;if(c.user&&this.errorSubmitting){g="red"}else if(c.user){g="gold"}d+=kt();t.textAlign="right";var v=h-2*o-r;if(this.submitting&&c.user){var m=Date.now().valueOf()/1e3;var b=m-this.submittingStartTime;var w=Math.floor(2*b%3+1);var x=".".repeat(w);u(t,x,h-o,d,g,n)}else if(this.errorSubmitting&&c.user){u(t,"ERROR",h-o,d,g,n)}else if(c.user&&!this.submitted){if(this.usernameEntry.style.visibility==="visible"){this.usernameEntry.style.fontSize=xt()+"px";this.usernameEntry.style.width=v+"px";this.usernameEntry.style.left=h-o-v+"px";this.usernameEntry.style.right=h-o+"px";this.usernameEntry.style.top=d-4+"px"}}else{u(t,c.name,h-o,d,g,n,v,false)}u(t,p+1+".",r,d,g,n);t.textAlign="center";u(t,c.score,l,d,g,n)}};S.prototype.drawLoadingAnimation=function(t,e,i,s,n){var a=5*e%(2*Math.PI);var r=15*e%this.imgs.flappy.length;var o=Math.floor(2*e%3+1);var d=this.imgs.flappy[Math.floor(r)];if(n){var f=".".repeat(o);t.textAlign="middle";t.textBaseline="bottom";t.font="30px FlappyFont";u(t,f,i,s+8,"white",2)}var l=-35;var p=-d.width/2;var c=-d.height/2;t.translate(i,s);t.rotate(a);t.translate(0,l);h(t,d,p,c);t.translate(0,-l);t.rotate(-a);t.translate(-i,-s)};S.prototype.drawStats=function(){this.stats.style.visibility="visible";var t="";t+="Score: "+this.score+"<br>";t+="Paused: "+this.paused+"<br>";t+="State: "+x(this.state)+"<br>";t+="PosX: "+this.bird.posX.toFixed(2)+"<br>";t+="PosY: "+this.bird.posY.toFixed(2)+"<br>";t+="VelX: "+this.bird.velX.toFixed(2)+"<br>";t+="VelY: "+this.bird.velY.toFixed(2)+"<br>";t+="Gravity: "+this.gravity;this.stats.innerHTML=t};S.prototype.drawFlappy=function(t){var e=this.bird.posX-this.cameraX;var i=t.canvas.height-this.bird.posY;var s=this.bird.ang;if(this.debugView){t.beginPath();t.moveTo(e,i);t.lineTo(e+this.bird.velX,i-this.bird.velY);t.strokeStyle="black";t.stroke();if(this.state!==c){t.beginPath();t.moveTo(e,i);var n=10;for(var a=0;a<300;a+=n){var r=a/this.bird.velX;var o=this.bird.velY*r+.5*this.gravity*r*r;t.lineTo(e+a,i-o)}t.strokeStyle="red";t.stroke()}}var d=this.flappyCurrent;var u=-d.width/2;var f=-d.height/2;t.translate(e,i);t.rotate(s);t.translate(u,f);h(t,d,0,0);t.translate(-u,-f);t.rotate(-s);t.translate(-e,-i);if(this.debugView){var l=this.bird.getBB(this.flappyCurrent.width,this.flappyCurrent.height,t.canvas.height);l.x-=this.cameraX;t.strokeStyle="green";l.draw(t)}};S.prototype.drawPipe=function(t,e){var i=e.x-this.cameraX;var s=t.canvas.height-e.y;var n=s-e.spacing;t.scale(1,-1);d(t,this.imgs.pipe,i,-n,1,undefined);h(t,this.imgs.pipeHead,i,-n);t.scale(1,-1);d(t,this.imgs.pipe,i,s,1,undefined);h(t,this.imgs.pipeHead,i,s);if(this.debugView){var a=e.bbUpper(this.imgs.pipeHead.width);a.x-=this.cameraX;var r=e.bbLower(this.imgs.pipeHead.width);r.x-=this.cameraX;t.strokeStyle="blue";a.draw(t);r.draw(t);t.beginPath();t.rect(i+this.imgs.pipeHead.width/4*1.5,n,this.imgs.pipeHead.width/4,e.spacing);t.strokeStyle="gold";t.stroke()}};function T(t,e,i,s,n){this.x=t;this.y=e;this.w=i;this.h=s;this.rot=n}T.prototype.render=function(t){offsetX=-this.w/2;offsetY=-this.h/2;t.translate(this.x,this.y);t.rotate(this.rot);t.translate(offsetX,offsetY);t.strokeRect(0,0,this.w,this.h);t.translate(-offsetX,-offsetY);t.rotate(-this.rot);t.translate(-this.x,-this.y)};function F(){this.out=document.getElementById("out");this.canvas=document.getElementById("canvas");this.lmbDown=false;this.mouseX=0;this.mouseY=0;var t=this;window.onmousedown=function(e){if(e.button==0)t.lmbDown=true;t.mouseX=e.offsetX;t.mouseY=e.offsetY};window.onmousemove=function(e){t.mouseX=e.offsetX;t.mouseY=e.offsetY};window.onmouseup=function(e){if(e.button==0)t.lmbDown=false};window.onmousewheel=function(e){t.r1.rot+=e.deltaY*5e-4};this.r1=new T(100,200,200,300,0);this.r2=new T(500,500,350,150,1)}F.prototype.mainLoop=function(){requestAnimationFrame(this.mainLoop.bind(this));this.update();this.render()};F.prototype.update=function(){if(this.lmbDown){this.r1.x=this.mouseX;this.r1.y=this.mouseY}};F.prototype.render=function(){var t=this.canvas.getContext("2d");t.fillStyle="grey";t.fillRect(0,0,t.canvas.width,t.canvas.height);t.strokeStyle="red";this.r1.render(t);t.strokeStyle="blue";this.r2.render(t);var e=this.r1;var i=this.r2;if(E(e.x,e.y,e.w,e.h,e.rot,i.x,i.y,i.w,i.h,i.rot)){this.out.innerHTML="Intersects"}else{this.out.innerHTML="Doesn't Intersect"}var s=e.x,n=e.y,a=i.x,r=i.y;var o=e.rot,h=i.rot;var d=i.w,u=i.h;a-=s;r-=n;var f=Math.sin(-o);var l=Math.cos(-o);var p=a*l-r*f;var c=a*f+r*l;h-=o;a=s+p;r=n+c;f=Math.sin(h);l=Math.cos(h);var g=d/2;var y=u/2;var v=k(f,l,-g,-y);v.x+=a;v.y+=r;var m=k(f,l,g,-y);m.x+=a;m.y+=r;var b=k(f,l,-g,y);b.x+=a;b.y+=r;var w=k(f,l,g,y);w.x+=a;w.y+=r;var x=new T(a,r,i.w,i.h,h);t.strokeStyle="green";x.render(t);var L=new T(e.x,e.y,e.w,e.h,0);L.render(t);t.strokeStyle="black";t.beginPath();t.moveTo(v.x,v.y);t.lineTo(m.x,m.y);t.stroke()};function E(t,e,i,s,n,a,r,o,h,d){a-=t;r-=e;var u=Math.sin(-n);var f=Math.cos(-n);var l=a*f-r*u;var p=a*u+r*f;d-=n;a=t+l;r=e+p;u=Math.sin(d);cs=Math.cos(d);var c=o/2;var g=h/2;var y=k(u,cs,-c,-g);y.x+=a;y.y+=r;var v=k(u,cs,c,-g);v.x+=a;v.y+=r;var m=k(u,cs,-c,g);m.x+=a;m.y+=r;var b=k(u,cs,c,g);b.x+=a;b.y+=r;var w=false;w=w||P(t,e,i,s,y.x,y.y,v.x,v.y);w=w||P(t,e,i,s,m.x,m.y,b.x,b.y);w=w||P(t,e,i,s,y.x,y.y,m.x,m.y);w=w||P(t,e,i,s,v.x,v.y,b.x,b.y);return w}function I(t,e,i,s){return i*e-s*t}function M(t,e,i,s){return i*t+s*e}function k(t,e,i,s){return{x:I(t,e,i,s),y:M(t,e,i,s)}}function P(t,e,i,s,n,a,r,o){t-=i/2;e-=s/2;var h=n;var d=r;if(n>r){h=r;d=n}if(d>t+i)d=t+i;if(h<t)h=t;if(h>d)return false;var u=a;var f=o;var l=r-n;if(Math.abs(l)>1e-7){var p=(o-a)/l;var c=a-p*n;u=p*h+c;f=p*d+c}if(u>f){var g=f;f=u;u=g}if(f>e+s)f=e+s;if(u<e)u=e;if(u>f)return false;return true}function A(t,e,i){this.reuse(t,e,i)}A.prototype.reuse=function(t,e,i){if(typeof i==="undefined")i=st();if(typeof e==="undefined")e=nt();this.x=t;this.y=e;this.spacing=i;this.passed=false;if(typeof this.upperCache==="undefined")this.upperCache=new T;if(typeof this.lowerCache==="undefined")this.lowerCache=new T};const D=2e3;A.prototype.bbUpper=function(t){this.upperCache.reuse(this.x+t/2,this.y+this.spacing+D/2,t,D,0);return this.upperCache};A.prototype.bbLower=function(t){this.lowerCache.reuse(this.x+t/2,this.y/2,t,this.y,0);return this.lowerCache};function T(t,e,i,s,n){this.reuse(t,e,i,s,n)}T.prototype.reuse=function(t,e,i,s,n){this.x=t;this.y=e;this.w=i;this.h=s;this.rot=n};T.prototype.draw=function(t){var e=-this.w/2;var i=-this.h/2;var s=t.canvas.height-this.y;t.translate(this.x,s);t.rotate(this.rot);t.translate(e,i);t.strokeRect(0,0,this.w,this.h);t.translate(-e,-i);t.rotate(-this.rot);t.translate(-this.x,-s)};T.prototype.intersects=function(t){return E(this.x,this.y,this.w,this.h,this.rot,t.x,t.y,t.w,t.h,t.rot)};const R="v0.1_BEST_SCORE";const C="api/leaderboard";const X="api/submit";const Y=16;const U=10;const H="-_";function O(t){r(R,t,365);console.log("Best score set: "+t)}function B(){var t=parseInt(o(R));if(isNaN(t)){t=0;O(0)}return t}function _(t){var e=true;var i="";if(typeof t!=="string"){e=false;i="Please enter a username."}else if(t===""){e=false;i="Please enter a username."}else if(t.length>Y){e=false;i="The username entered is too long."}else{for(var s=0;s<t.length;s++)if(!N(t[s])){e=false;i="The username contains the illegal character '"+t[s]+"'.";break}}return{legal:e,reason:i}}function N(t){var e=function(t){return t.charCodeAt(0)};var i=t.charCodeAt(0);if(i>=e("a")&&i<=e("z")){return true}else if(i>=e("A")&&i<=e("Z")){return true}else if(i>=e("1")&&i<=e("9")){return true}else if(H.indexOf(t)!==-1){return true}return false}function V(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(this.readyState==4){if(this.status===200){var i=this.responseText;var s=null;try{s=JSON.parse(i)}catch(t){e("Invalid JSON response: "+i)}t(s)}else{e(this.statusText+": "+this.responseText)}}};i.open("GET",C,true);i.send()}function W(t,e,i,s){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4){if(this.status===200){i()}else{var t=""+this.status;if(this.statusText)t+=" "+this.statusText;t+=": ";s(t+this.responseText)}}};var a="name="+encodeURIComponent(t)+"&score="+encodeURIComponent(e);n.open("POST",X,true);n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");n.send(a)}const j=320;const q=1440;const G=480;const z=850;const J=700;function K(){return document.getElementById("canvas").height}function Q(){return document.getElementById("canvas").width}function Z(){return(K()-G)/(z-G)}function $(){return(Q()-j)/(q-j)}function tt(){return($()+Z())/2}function et(t,e,i){return(e-t)*i+t}function it(t,e,i){
return Math.floor(et(t,e,i))}function st(){return 150}function nt(){var t=Math.random();var e=t*150+120;var i=t*300+200;return et(e,i,Z())}function at(){return et(170,350,Z())}function rt(){return it(80,120,$())}function ot(){return it(60,150,Z())}function ht(){return it(20,50,tt())}function dt(){return ht()+45}function ut(){return ht()}function ft(){return Q()<350}function lt(){return it(50,200,Z())}function pt(){return lt()+60+20}function ct(){return it(240,290,Z())}function gt(){return ct()+50}function yt(){return it(365,400,Z())}const vt=410;const mt=650;function bt(t,e){if(Q()>=vt&&K()>=mt){return e}else{return t}}function wt(){return bt(45,60)}function xt(){return bt(20,30)}function Lt(){return bt(4,5)}function St(){return bt(2,3)}function Tt(){return it(20,110,Z())}function Ft(){var t=Tt();return t+bt(420,540)}function Et(){return Tt()+wt()+Lt()*2+10}function It(){return bt(40,60)}function Mt(){return bt(80,130)}function kt(){return bt(30,40)}e[""]=t})({},function(){return this}());